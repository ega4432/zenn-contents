---
title: "Nuxt.js sitemap"
emoji: "🎉"
type: "tech"
topics: ["nuxtjs", "vue", "seo"]
published: false
---
# はじめに

Nuxt.js のプロジェクトで動的にサイトマップを生成すると機会があったので、一通り試してまとめみました。静的ファイルにビルド（`nuxt generate` コマンドを実行）するとエクスポートされたディレクトリに `sitemap.xml` を生成できます。

# モジュールのインストール

今回は下記の公式が提供しているモジュールを使いました。

https://sitemap.nuxtjs.org/

基本的には、こちらのモジュールを読み込んで、細かい設定を nuxt.config.js に定義していくといった流れです。下記が雛形です。

```sh
$ yarn add @nuxtjs/sitemap
```

```diff js:nuxt.config.js
export default {
  modules: [
    '@nuxtjs/axios',
+   '@nuxtjs/sitemap'
  ]
}
```

:::message
複数のモジュールを使用する場合は、上記のようにサイトマップのモジュールを最後に記述する必要があります。
:::

あとは任意でカスタマイズしたい場合は設定を追加していくだけです。


```diff js:nuxt.config.js
export default {
  modules: [
    '@nuxtjs/axios',
    '@nuxtjs/sitemap'
  ],
+  sitemap: {
+    // options: ここに追記していく
+  }
}
```

# オプション

それでは続いてカスタマイズしたい項目について使ったものだけピックアップして紹介します。

## hostname

サイトの URL を記載します。SPA, SSG では指定が必須となっているので忘れずに定義しましょう。

```diff js:nuxt.config.js
export default {
  sitemap: {
+   hostname: 'https://example.com'
  }
}
```

[dotenv](https://github.com/nuxt-community/dotenv-module) モジュールなどを利用して環境変数から値を取得できる状態になっていれば、ベタ書きするよりも `process.env.BASE_URL` としておいた方が良いでしょう。

## path

続いては、サイトマップを吐き出すパスを指定します。デフォルトだと `./sitemap.xml` になっているのでそのままでいい場合は特に設定する必要はありません。

```diff js:nuxt.config.js
export default {
  sitemap: {
    hostname: 'https://example.com'
+   path: 'custom-sitemap.xml'
  }
}
```

## defaults

サイトマップの設定値のデフォルトとなるパラメータを定義します。複数のサイトマップを生成したい場合などはここにまとめることができるので非常に便利です。

設定できるパラメータについて詳しく知りたい方は、下記に詳細なパラメータがリストアップされているのでそちらをご覧ください。

https://github.com/ekalinin/sitemap.js/blob/4.1.1/README.md#sitemap-item-options

今回は、サイトマップの最終更新日時（`lastmod`）や更新頻度（`changefreq`）を設定してみました。

```diff js:nuxt.config.js
export default {
  sitemap: {
    hostname: 'https://example.com'
    path: 'custom-sitemap.xml',
+   defaults: {
+     lastmod: new Date(),
+     changefreq: 'daily'
+   }
  }
}
```

## exclude

サイトマップから除外したいパスを定義します。良くあるケースとしては、管理者ページなどのログイン後のページについては除外したいことが多いのではないでしょうか。

```diff js:nuxt.config.js
export default {
  sitemap: {
    hostname: 'https://example.com'
    path: 'custom-sitemap.xml',
    defaults: {},
+   exclude: ['/admin/**', '/tmp']
  }
}
```

## routes

基本的には、nuxt のルーティングと一致した静的なファイルパスを自動で生成してくれます。一方で、記事詳細（`/articles/:id`）などの動的なファイルパスは生成してくれません。なので、ここに追加で設定する必要があります。

```diff js:nuxt.config.js
export default {
  sitemap: {
    hostname: 'https://example.com'
    path: 'custom-sitemap.xml',
    defaults: {},
    exclude: ['/admin/**', '/tmp'],
+   routes() {}
  },
}
```


# ユースケース

## 複数のサイトマップを生成したい場合


## 複数の API を叩いてデータを取得したい場合


## ページネーションを返す API に対して全てのデータを取得したい場合


# まとめ

